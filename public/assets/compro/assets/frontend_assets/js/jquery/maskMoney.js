!function(b){"use strict";b.browser||(b.browser={},b.browser.mozilla=/mozilla/.test(navigator.userAgent.toLowerCase())&&!/webkit/.test(navigator.userAgent.toLowerCase()),b.browser.webkit=/webkit/.test(navigator.userAgent.toLowerCase()),b.browser.opera=/opera/.test(navigator.userAgent.toLowerCase()),b.browser.msie=/msie/.test(navigator.userAgent.toLowerCase()));var t={destroy:function(){return b(this).unbind(".maskMoney"),b.browser.msie&&(this.onpaste=null),this},mask:function(n){return this.each(function(){var e,t=b(this);return"number"==typeof n&&(t.trigger("mask"),e=b(t.val().split(/\D/)).last()[0].length,n=n.toFixed(e),t.val(n)),t.trigger("mask")})},unmasked:function(){return this.map(function(){var n,e=b(this).val()||"0",t=-1!==e.indexOf("-");return b(e.split(/\D/).reverse()).each(function(e,t){return t?(n=t,!1):void 0}),e=(e=e.replace(/\D/g,"")).replace(new RegExp(n+"$"),"."+n),t&&(e="-"+e),parseFloat(e)})},init:function(w){return w=b.extend({prefix:"",suffix:"",affixesStay:!0,thousands:",",decimal:".",precision:2,allowZero:!1,allowNegative:!1},w),this.each(function(){function f(){var e,t,n,a,r,o=m.get(0),i=0,s=0;return"number"==typeof o.selectionStart&&"number"==typeof o.selectionEnd?(i=o.selectionStart,s=o.selectionEnd):(t=document.selection.createRange())&&t.parentElement()===o&&(a=o.value.length,e=o.value.replace(/\r\n/g,"\n"),(n=o.createTextRange()).moveToBookmark(t.getBookmark()),(r=o.createTextRange()).collapse(!1),-1<n.compareEndPoints("StartToEnd",r)?i=s=a:(i=-n.moveStart("character",-a),i+=e.slice(0,i).split("\n").length-1,-1<n.compareEndPoints("EndToEnd",r)?s=a:(s=-n.moveEnd("character",-a),s+=e.slice(0,s).split("\n").length-1))),{start:i,end:s}}function s(e){var t="";return-1<e.indexOf("-")&&(e=e.replace("-",""),t="-"),t+w.prefix+e+w.suffix}function r(e){var t,n,a,r=-1<e.indexOf("-")&&w.allowNegative?"-":"",o=e.replace(/[^0-9]/g,""),i=o.slice(0,o.length-w.precision);return""===(i=(i=i.replace(/^0*/g,"")).replace(/\B(?=(\d{3})+(?!\d))/g,w.thousands))&&(i="0"),t=r+i,0<w.precision&&(n=o.slice(o.length-w.precision),a=new Array(w.precision+1-n.length).join(0),t+=w.decimal+a+n),s(t)}function p(e){var t,a,n=m.val().length;m.val(r(m.val())),t=m.val().length,a=e-=n-t,m.each(function(e,t){if(t.setSelectionRange)t.focus(),t.setSelectionRange(a,a);else if(t.createTextRange){var n=t.createTextRange();n.collapse(!0),n.moveEnd("character",a),n.moveStart("character",a),n.select()}})}function n(){var e=m.val();m.val(r(e))}function h(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function a(e){var t,n,a,r,o,i,s,l,c,u,v,g,d=(e=e||window.event).which||e.charCode||e.keyCode;return void 0!==d&&(d<48||57<d?45===d?(m.val((g=m.val(),w.allowNegative?""!==g&&"-"===g.charAt(0)?g.replace("-",""):"-"+g:g)),!1):43===d?(m.val(m.val().replace("-","")),!1):(13===d||9===d||(!b.browser.mozilla||37!==d&&39!==d||0!==e.charCode)&&h(e),!0):(i=!(m.val().length>=m.attr("maxlength")&&0<=m.attr("maxlength")),s=f(),l=s.start,c=s.end,u=!(s.start===s.end||!m.val().substring(l,c).match(/\d/)),v="0"===m.val().substring(0,1),(i||u||v)&&(h(e),t=String.fromCharCode(d),a=(n=f()).start,r=n.end,o=m.val(),m.val(o.substring(0,a)+t+o.substring(r,o.length)),p(a+1)),!1))}function e(){setTimeout(function(){n()},0)}function o(){return(parseFloat("0")/Math.pow(10,w.precision)).toFixed(w.precision).replace(new RegExp("\\.","g"),w.decimal)}var i,m=b(this);w=b.extend(w,m.data()),m.unbind(".maskMoney"),m.bind("keypress.maskMoney",a),m.bind("keydown.maskMoney",function(e){var t,n,a,r,o,i=(e=e||window.event).which||e.charCode||e.keyCode;return void 0!==i&&(n=(t=f()).start,a=t.end,8!==i&&46!==i&&63272!==i||(h(e),r=m.val(),n===a&&(8===i?""===w.suffix?n-=1:(o=r.split("").reverse().join("").search(/\d/),a=1+(n=r.length-o-1)):a+=1),m.val(r.substring(0,n)+r.substring(a,r.length)),p(n),!1))}),m.bind("blur.maskMoney",function(e){if(b.browser.msie&&a(e),""===m.val()||m.val()===s(o()))w.allowZero?w.affixesStay?m.val(s(o())):m.val(o()):m.val("");else if(!w.affixesStay){var t=m.val().replace(w.prefix,"").replace(w.suffix,"");m.val(t)}m.val()!==i&&m.change()}),m.bind("focus.maskMoney",function(){i=m.val(),n();var e,t=m.get(0);t.createTextRange&&((e=t.createTextRange()).collapse(!1),e.select())}),m.bind("click.maskMoney",function(){var e,t=m.get(0);t.setSelectionRange?(e=m.val().length,t.setSelectionRange(e,e)):m.val(m.val())}),m.bind("cut.maskMoney",e),m.bind("paste.maskMoney",e),m.bind("mask.maskMoney",n)})}};b.fn.maskMoney=function(e){return t[e]?t[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void b.error("Method "+e+" does not exist on jQuery.maskMoney"):t.init.apply(this,arguments)}}(window.jQuery||window.Zepto);